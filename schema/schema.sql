DROP TABLE IF EXISTS Settings;
CREATE TABLE IF NOT EXISTS Settings (
  key   TEXT NOT NULL PRIMARY KEY,
  value TEXT NOT NULL
);

INSERT INTO Settings (
  key, value
) VALUES (
  'username_default', 'anonymous'
),(
  'claim_chance_random', '0.1'
),(
  'claim_duration_hours', '24'
),(
  'checkout_range_minimum', '100000'
),(
  'checkout_range_default', '1000000000'
),(
  'checkout_range_maximum', '100000000000000'
);

DROP TABLE IF EXISTS BaseData;
CREATE TABLE IF NOT EXISTS BaseData (
  base                    INTEGER PRIMARY KEY,
  range_start             NUMERIC NOT NULL,
  range_end               NUMERIC NOT NULL,
  range_total             NUMERIC NOT NULL,
  range_complete_detailed NUMERIC NOT NULL DEFAULT 0,
  status_detailed         INTEGER NOT NULL DEFAULT 0, 
    -- Status Codes: 0 = None assigned, 1 = Some assigned, 2 = All assigned, 3 = All complete
  range_complete_niceonly NUMERIC NOT NULL DEFAULT 0,
  status_niceonly         INTEGER NOT NULL DEFAULT 0,
  niceness_mean           REAL,
  niceness_stdev          REAL,
  niceness_distribution   JSONB,
  residue_filter_classes  JSONB
);

INSERT INTO BaseData (
    base,
    range_start,
    range_end,
    range_total
) VALUES (
    10, 47, 100, 53
),(
    12, 144, 329, 185
),(
    13, 398, 609, 211
),(
    14, 734, 1138, 404
),(
    15, 1369, 3375, 2006
),(
    17, 4913, 12632, 7719
),(
    18, 15285, 24743, 9458
),(
    19, 29898, 48838, 18940
),(
    20, 58945, 160000, 101055
),(
    22, 234256, 656394, 422138
),(
    23, 795831, 1342070, 546239
),(
    24, 1625364, 2760487, 1135123
),(
    25, 3339797, 9765625, 6425828
),(
    27, 14348907, 43046721, 28697814
),(
    28, 52260814, 91068707, 38807893
),(
    29, 110455918, 193607415, 83151497
),(
    30, 234613921, 729000000, 494386079
),(
    32, 1073741824, 3408917801, 2335175977
),(
    33, 4142427847, 7418918653, 3276490806
),(
    34, 9007680237, 16212853071, 7205172834
),(
    35, 19669212048, 64339296875, 44670084827
),(
    37, 94931877133, 316334075400, 221402198267
),(
    38, 384662374829, 705305019487, 320642644658
),(
    39, 857007362029, 1578199811605, 721192449576
),(
    40, 1916284264916, 6553600000000, 4637315735084
),(
    42, 9682651996416, 33657156332704, 23974504336288
),(
    43, 40948418181959, 76644654780098, 35696236598139
),(
    44, 93185373471696, 175088059533483, 81902686061787
),(
    45, 212736390383970, 756680642578125, 543944252194155
),(
    47, 1119130473102767, 4038747238411221, 2919616765308454
),(
    48, 4915694472847618, 9371125521380410, 4455431048532792
),(
    49, 11398895185373143, 21805302049254337, 10406406863881194
),(
    50, 26507984537059635, 97656250000000000, 71148265462940365
),(
    52, 144555105949057024, 539553545729754716, 394998439780697692
),(
    53, 656927313525736563, 1273200002519225123, 616272688993488560
),(
    54, 1549296280153679229, 3012081865832165437, 1462785585678486208
),(
    55, 3663267963587310490, 13931233916552734375, 10267965952965423885
),(
    57, 20635899893042801193, 79417284083290121110, 58781384190247319917
),(
    58, 96720216587923470200, 190292611382256487046, 93572394794333016846
),(
    59, 231631774300498175921, 457025187843752651284, 225393413543254475363
),(
    60, 556029612114824200908, 2176782336000000000000, 1620752723885175799092
),(
    62, 3226266762397899821056, 12769214149485414002625, 9542947387087514181569
),(
    63, 15554883995458128017102, 31028220435813762842783, 15473336440355634825681
),(
    64, 37778931862957161709568, 75557863725914323419136, 37778931862957161709568
),(
    65, 91953694755747944887348, 369720589101871337890625, 277766894346123393003277
),(
    67, 548242166610401428685587, 2226711930380699816096047, 1678469763770298387410460
),(
    68, 2713014840550843048084693, 5481132762150707758294492, 2768117921599864710209799
),(
    69, 6675176061585159609396207, 13518782268207176832811052, 6843606206622017223414845
),(
    70, 16456591172673850596148008, 67822307284900000000000000, 51365716112226149403851992
),(
    72, 100613197241791537106386944, 418567767936362069572345715, 317954570694570532465958771
),(
    73, 510067510899210671569684485, 1042753057052925528319980608, 532685546153714856750296123
),(
    74, 1270164399631151609970127595, 2602546848843790131749282443, 1332382449212638521779154848
),(
    75, 3168826999456348122876221569, 13363461010158061981201171875, 10194634010701713858324950306
),(
    77, 19831742626597600733536317893, 84370596447924841711282026183, 64538853821327240977745708290
),(
    78, 102829385677598770765476816824, 212552560827314537079998520880, 109723175149715766314521704056
),(
    79, 258952384818697126217483561852, 536402874970405947886221110016, 277450490151708821668737548164
),(
    80, 653245554420798943087177909799, 2814749767106560000000000000000, 2161504212685761056912822090201
),(
    82, 4178511850022702569647809560576, 18153467370488382082912158238502, 13974955520465679513264348677926
),(
    83, 22128000647627410287823658733218, 46215592392554101199819881923577, 24087591744926690911996223190359
),(
    84, 56312942377237435733597461491303, 117847787762372019720041629099902, 61534845385134583986444167608599
),(
    85, 143543025330965793204023642513500, 631134233006543551770782470703125, 487591207675577758566758828189625
),(
    87, 937189241636402729052111114871767, 4152730160229842931225619560583684, 3215540918593440202173508445711917
),(
    88, 5062514932976556158810392405111548, 10676939027766271546986710934937444, 5614424094789715388176318529825896
),(
    89, 13011432596758118980166663776661963, 27493083477539855732941476548882915, 14481650880781736752774812772220952
),(
    90, 33492764832792484045981163311105668, 150094635296999121000000000000000000, 116601870464206636954018836688894332
),(
    92, 222936352980619746738642598267715584, 1006414382715517303438673391306068322, 783478029734897556700030793038352738
),(
    93, 1227026823693494988240298801231589358, 2611767709851295110833965439411947098, 1384740886157800122593666638180357740
),(
    94, 3183210008247514747571732759297930427, 6787657716144154042932225060516571159, 3604447707896639295360492301218640732
),(
    95, 8270034070172644280043770101532655486, 37735360253530761511306362152099609375, 29465326183358117231262592050566953889
),(
    97, 56061272466674974994842655144706937633, 257584778620893462863781151065643617026, 201523506154218487868938495920936679393
),(
    98, 314077961412981426721793941782627033363, 674385891431749145198614986805297551928, 360307930018767718476821045022670518565
),(
    99, 822027401648073619380763084184330394736, 1768040302014098620688529178436237014791, 946012900366025001307766094251906620055
),(
    100, 2154434690031883721759293566519350495260, 10000000000000000000000000000000000000000, 7845565309968116278240706433480649504740
),(
    102, 14859473959783543420355740092833203224576, 69428347070543538615946882287174273757976, 54568873110759995195591142194341070533400
),(
    103, 84662333725309633055433503804367276807317, 183300270751547080160196308246897671033019, 98637937026237447104762804442530394225702
),(
    104, 223451593260243196789408037138137685198232, 484569057874882311316709362495460560366621, 261117464614639114527301325357322875168389
),(
    105, 590534825282312433877154477036433913752051, 2785962590401641140642702303409576416015625, 2195427765119328706765547826373142502263574
),(
    107, 4140562374860211619063098135818149338786107, 19657151761702482426010581015956053883703275, 15516589386842270806947482880137904544917168
),(
    108, 23972138805573247931811827875322487668111501, 52313134511111761817206545830883217687979462, 28340995705538513885394717955560730019867961
),(
    109, 63777825177014042019899448407756440102057635, 139392943409794013070883752285779142152669670, 75615118232779971050984303878022702050612035
),(
    110, 169892749571608053239273597713205371466519752, 814027493868397611133210000000000000000000000, 644134744296789557893936402286794628533480248
),(
    112, 1210031005620407731441647292112097713789599744, 5832693735216399861579274069152955835269318860, 4622662729595992130137626777040858121479719116
),(
    113, 7113531152938170050080298430931150879177294860, 15641016651472246651771236921443688311058517002, 8527485498534076601690938490512537431881222142
),(
    114, 19070371573640704354450878898973266997285962779, 41992973732696853622390485918888029221062076869, 22922602159056149267939607019914762223776114090
),(
    115, 51185982989888351322147485818486108863801971665, 248914575574969196729123984701240062713623046875, 197728592585080845406976498882753953849821075210
),(
    117, 370062279932904031985640853895956432562633260413, 1809964710693864866193448021015911646067898988383, 1439902430760960834207807167119955213505265727970
),(
    118, 2207565019901695695901620331019946754153851512075, 4889080315354597701381902850838633207260182701188, 2681515295452902005480282519818686453106331189113
),(
    119, 5961473156276631602289828303352911108996388321186, 13221419536275053077588736719480315339009797911471, 7259946379998421475298908416127404230013409590285
),(
    120, 16117196090075248994613996554363597629408239219454, 79496847203390844133441536000000000000000000000000, 63379651113315595138827539445636402370591760780546
);

DROP TABLE IF EXISTS NiceNumbers; -- for external reference in NiceNumbers
DROP TABLE IF EXISTS SearchFieldsDetailed;
CREATE TABLE IF NOT EXISTS SearchFieldsDetailed (
  id                  SERIAL PRIMARY KEY,
  base                INTEGER NOT NULL,
  search_start        NUMERIC NOT NULL UNIQUE,
  search_end          NUMERIC NOT NULL,
  search_range        NUMERIC NOT NULL,
  claimed_time        TIMESTAMP NOT NULL,
  expired_time        TIMESTAMP NOT NULL,
  completed_time      TIMESTAMP,
  username            TEXT NOT NULL,
  client_version      TEXT,
  unique_distribution JSONB
);

DROP TABLE IF EXISTS SearchFieldsNiceonly;
CREATE TABLE IF NOT EXISTS SearchFieldsNiceonly (
  id              SERIAL PRIMARY KEY,
  base            INTEGER NOT NULL,
  search_start    NUMERIC NOT NULL UNIQUE,
  search_end      NUMERIC NOT NULL,
  search_range    NUMERIC NOT NULL,
  claimed_time    TIMESTAMP NOT NULL,
  expired_time    TIMESTAMP NOT NULL,
  completed_time  TIMESTAMP,
  username        TEXT NOT NULL,
  client_version  TEXT,
  nice_list       JSONB
);

-- DROP TABLE IF EXISTS NiceNumbers;
CREATE TABLE IF NOT EXISTS NiceNumbers (
  field_id  INTEGER NOT NULL REFERENCES SearchFieldsDetailed (id),
  number    NUMERIC PRIMARY KEY,
  uniques   INTEGER NOT NULL
);