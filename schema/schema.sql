DROP TABLE IF EXISTS Settings;
CREATE TABLE IF NOT EXISTS Settings (
  key   TEXT NOT NULL PRIMARY KEY,
  value TEXT NOT NULL
);

INSERT INTO Settings (
  key, value
) VALUES (
  'username_default', 'anonymous'
),(
  'claim_duration_hours', '24'
),(
  'base_current_detailed', '10'
),(
  'base_current_niceonly', '10'
),(
  'checkout_range_minimum', '100000'
),(
  'checkout_range_default', '10000000'
),(
  'checkout_range_maximum', '100000000000000'
);

DROP TABLE IF EXISTS BaseData;
CREATE TABLE IF NOT EXISTS BaseData (
  base                    INTEGER PRIMARY KEY,
  range_start             NUMERIC NOT NULL,
  range_end               NUMERIC NOT NULL,
  range_total             NUMERIC NOT NULL,
  range_complete_detailed NUMERIC NOT NULL DEFAULT 0,
  range_complete_niceonly NUMERIC NOT NULL DEFAULT 0,
  niceness_mean           REAL,
  niceness_stdev          REAL,
  niceness_distribution   JSONB,
  residue_filter_classes  JSONB
);

INSERT INTO BaseData (
    base,
    range_start,
    range_end,
    range_total
) VALUES (
    10, 47, 100, 53
),(
    12, 144, 329, 185
),(
    13, 398, 609, 211
),(
    14, 734, 1138, 404
),(
    15, 1369, 3375, 2006
),(
    17, 4913, 12632, 7719
),(
    18, 15285, 24743, 9458
),(
    19, 29898, 48838, 18940
),(
    20, 58945, 160000, 101055
),(
    22, 234256, 656394, 422138
),(
    23, 795831, 1342070, 546239
),(
    24, 1625364, 2760487, 1135123
),(
    25, 3339797, 9765625, 6425828
),(
    27, 14348907, 43046720, 28697813
),(
    28, 52260814, 91068707, 38807893
),(
    29, 110455918, 193607415, 83151497
),(
    30, 234613921, 729000000, 494386079
),(
    32, 1073741824, 3408917801, 2335175977
),(
    33, 4142427847, 7418918653, 3276490806
),(
    34, 9007680237, 16212853071, 7205172834
),(
    35, 19669212048, 64339296875, 44670084827
),(
    37, 94931877133, 316334075400, 221402198267
),(
    38, 384662374829, 705305019487, 320642644658
),(
    39, 857007362029, 1578199811605, 721192449576
),(
    40, 1916284264916, 6553600000000, 4637315735084
),(
    42, 9682651996416, 33657156332705, 23974504336289
),(
    43, 40948418181960, 76644654780098, 35696236598138
),(
    44, 93185373471696, 175088059533483, 81902686061787
),(
    45, 212736390383969, 756680642578125, 543944252194156
),(
    47, 1119130473102767, 4038747238411230, 2919616765308463
),(
    48, 4915694472847629, 9371125521380410, 4455431048532781
),(
    49, 11398895185373144, 21805302049254288, 10406406863881144
),(
    50, 26507984537059572, 97656250000000000, 71148265462940428
),(
    52, 144555105949057024, 539553545729755968, 394998439780698944
),(
    53, 656927313525738112, 1273200002519225088, 616272688993486976
),(
    54, 1549296280153679104, 3012081865832158208, 1462785585678479104
),(
    55, 3663267963587301888, 13931233916552734375, 10267965952965432487
),(
    57, 20635899893042801193, 79417284083290308608, 58781384190247507415
),(
    58, 96720216587923701760, 190292611382256500736, 93572394794332798976
),(
    59, 231631774300498165760, 457025187843751542784, 225393413543253377024
),(
    60, 556029612114822823936, 2176782336000000000000, 1620752723885177176064
),(
    62, 3226266762397899821056, 12769214149485444202496, 9542947387087544381440
),(
    63, 15554883995458166849536, 31028220435813764169728, 15473336440355597320192
),(
    64, 37778931862957161709568, 75557863725914138869760, 37778931862956977160192
),(
    65, 91953694755747725836288, 369720589101871337890625, 277766894346123612054337
),(
    67, 548242166610401428685587, 2226711930380705446494208, 1678469763770304017808621
),(
    68, 2713014840550849949728768, 5481132762150707348373504, 2768117921599857398644736
),(
    69, 6675176061585159801012224, 13518782268207142111543296, 6843606206621982310531072
),(
    70, 16456591172673808390684672, 67822307284900000000000000, 51365716112226191609315328
),(
    72, 100613197241791537106386944, 418567767936363122560860160, 317954570694571585454473216
),(
    73, 510067510899211981866139648, 1042753057052925553033609216, 532685546153713571167469568
),(
    74, 1270164399631151692362285056, 2602546848843783477999435776, 1332382449212631785637150720
),(
    75, 3168826999456340022208233472, 13363461010158061981201171875, 10194634010701721958992938403
),(
    77, 19831742626597600733536317893, 84370596447925058945081671680, 64538853821327458211545353787
),(
    78, 102829385677599043122217615360, 212552560827314537256896692224, 109723175149715494134679076864
),(
    79, 258952384818697138839280943104, 536402874970404595063786045440, 277450490151707456224505102336
),(
    80, 653245554420797269379253272576, 2814749767106560000000000000000, 2161504212685762730620746727424
),(
    82, 4178511850022702569647809560576, 18153467370488286362517609906176, 13974955520465583792869800345600
),(
    83, 22128000647627296611205424087040, 46215592392554101946134894215168, 24087591744926805334929470128128
),(
    84, 56312942377237436720976274391040, 117847787762372639018425476186112, 61534845385135202297449201795072
),(
    85, 143543025330966545404800782041088, 631134233006543551770782470703125, 487591207675577006365981688662037
),(
    87, 937189241636402729052111114871767, 4152730160229820904631006421581824, 3215540918593418175578895306710057
),(
    88, 5062514932976529586597205370732544, 10676939027766270477820305885626368, 5614424094789740891223100514893824
),(
    89, 13011432596758118080476256443301888, 27493083477539999861868280944787456, 14481650880781881781392024501485568
),(
    90, 33492764832792660340206623285837824, 150094635296999121000000000000000000, 116601870464206460659793376714162176
),(
    92, 222936352980619746738642598267715584, 1006414382715511987318491890633932800, 783478029734892240579849292366217216
),(
    93, 1227026823693488410066319562221027328, 2611767709851295000237009128665382912, 1384740886157806590170689566444355584
),(
    94, 3183210008247514621856827687013711872, 6787657716144190718598832470745939968, 3604447707896676096742004783732228096
),(
    95, 8270034070172688963713363087877734400, 37735360253530761511306362152099609375, 29465326183358072547592999064221874975
),(
    97, 56061272466674974994842655144706937633, 257584778620892071932437307438972010496, 201523506154217096937594652294265072863
),(
    98, 314077961412979714847847291330888728576, 674385891431749144400180299822962573312, 360307930018769429552333008492073844736
),(
    99, 822027401648073622143818157151429328896, 1768040302014108114393516016315106590720, 946012900366034492249697859163677261824
),(
    100, 2154434690031895347070050542973288972288, 10000000000000000000000000000000000000000, 7845565309968104652929949457026711027712
),(
    102, 14859473959783543420355740092833203224576, 69428347070543160469303089680891978448896, 54568873110759617048947349588058775224320
),(
    103, 84662333725309164319128195942951302463488, 183300270751547089528462294260021926559744, 98637937026237925209334098317070624096256
),(
    104, 223451593260243189709789730294834818711552, 484569057874884945452303839368236916277248, 261117464614641755742514109073402097565696
),(
    105, 590534825282315715885670887302029522239488, 2785962590401641140642702303409576416015625, 2195427765119325424757031416107546893776137
),(
    107, 4140562374860211619063098135818149338786107, 19657151761702374129909274092334103635427328, 15516589386842162510846175956515954296641221
),(
    108, 23972138805573115157417678649454476700680192, 52313134511111764858536860150489700473241600, 28340995705538649701119181501035223772561408
),(
    109, 63777825177014041641973029059380276954660864, 139392943409794782884247944515021742526169088, 75615118232780741242274915455641465571508224
),(
    110, 169892749571608999074198030294455898238615552, 814027493868397611133210000000000000000000000, 644134744296788612059011969705544101761384448
),(
    112, 1210031005620407731441647292112097713789599744, 5832693735216367234178187583902247956363870208, 4622662729595959502736540291790150242574270464
),(
    113, 7113531152938129995219586728966188677533270016, 15641016651472247406383016721856539796298530816, 8527485498534117411163429992890351118765260800
),(
    114, 19070371573640705072888813805449604446455595008, 41992973732697088165028690576929745066153476096, 22922602159056383092139876771480140619697881088
),(
    115, 51185982989888638843917209766019263277106724864, 248914575574969196729123984701240062713623046875, 197728592585080557885206774935220799436516322011
),(
    117, 370062279932904031985640853895956432562633260413, 1809964710693854693633263773169157523079388200960, 1439902430760950661647622919273201090516754940547
),(
    118, 2207565019901683363796245497571380608805770362880, 4889080315354597764862662460304680455313719033856, 2681515295452914401066416962733299846507948670976
),(
    119, 5961473156276631605691938529898823672027869609984, 13221419536275127527307155615618065981321859039232, 7259946379998495921615217085719242309293989429248
),(
    120, 16117196090075340156396261598865554465633557544960, 79496847203390844133441536000000000000000000000000, 63379651113315503977045274401134445534366442455040
);

DROP TABLE IF EXISTS NiceNumbers; -- for external reference in NiceNumbers
DROP TABLE IF EXISTS SearchFieldsDetailed;
CREATE TABLE IF NOT EXISTS SearchFieldsDetailed (
  id                  SERIAL PRIMARY KEY,
  canon               BOOLEAN NOT NULL DEFAULT TRUE,
  base                INTEGER NOT NULL,
  search_start        NUMERIC NOT NULL,
  search_end          NUMERIC NOT NULL,
  search_range        NUMERIC NOT NULL,
  claimed_time        TIMESTAMP NOT NULL,
  expired_time        TIMESTAMP NOT NULL,
  completed_time      TIMESTAMP,
  username            TEXT NOT NULL,
  client_version      TEXT,
  unique_distribution JSONB
);

DROP TABLE IF EXISTS SearchFieldsNiceonly;
CREATE TABLE IF NOT EXISTS SearchFieldsNiceonly (
  id              SERIAL PRIMARY KEY,
  canon           BOOLEAN NOT NULL DEFAULT TRUE,
  base            INTEGER NOT NULL,
  search_start    NUMERIC NOT NULL,
  search_end      NUMERIC NOT NULL,
  search_range    NUMERIC NOT NULL,
  claimed_time    TIMESTAMP NOT NULL,
  expired_time    TIMESTAMP NOT NULL,
  completed_time  TIMESTAMP,
  username        TEXT NOT NULL,
  client_version  TEXT,
  nice_list       JSONB
);

DROP TABLE IF EXISTS NiceNumbers;
CREATE TABLE IF NOT EXISTS NiceNumbers (
  field_id  INTEGER NOT NULL REFERENCES SearchFieldsDetailed (id),
  number    NUMERIC PRIMARY KEY,
  uniques   INTEGER NOT NULL
);